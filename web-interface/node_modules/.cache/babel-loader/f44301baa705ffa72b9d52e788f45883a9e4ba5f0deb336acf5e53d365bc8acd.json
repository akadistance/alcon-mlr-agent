{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\josep\\\\OneDrive\\\\Documents\\\\Jason\\\\EyeQ MLR Agent\\\\alcon-mlr-agent\\\\web-interface\\\\src\\\\components\\\\MessageBubble.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport { CheckCircle, FileText, Copy, Check, RefreshCw, Share2, Download, Pencil } from 'lucide-react';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport FloatingAddToChatButton from './FloatingAddToChatButton';\nimport { ChatContext } from '../ChatContext';\nimport { useAnimatedText } from './ui/animated-text';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MessageBubble = ({\n  message,\n  isLast,\n  onRegenerate,\n  onShare,\n  onExport,\n  onEdit,\n  isLastUserMessage = false\n}) => {\n  _s();\n  const {\n    type,\n    content,\n    analysis,\n    file,\n    isLoading,\n    isError,\n    isStreaming\n  } = message;\n  const [copied, setCopied] = useState(false);\n  const [isEditing, setIsEditing] = useState(false);\n  const [editValue, setEditValue] = useState(content || '');\n  const editRef = useRef(null);\n  const [selectedText, setSelectedText] = useState('');\n  const [selectionPosition, setSelectionPosition] = useState(null);\n  const messageRef = useRef(null);\n  const selectedTextRef = useRef('');\n  const {\n    setSelectedTextContext\n  } = React.useContext(ChatContext);\n\n  // Keep ref in sync with state\n  useEffect(() => {\n    selectedTextRef.current = selectedText;\n  }, [selectedText]);\n\n  // Parse content to separate main text from references section\n  const parseContentAndReferences = text => {\n    if (!text) return {\n      mainContent: '',\n      referencesText: null\n    };\n\n    // Check for References section\n    const referencesMatch = text.match(/(?:^|\\n)(References?:[\\s\\S]*)$/i);\n    if (referencesMatch) {\n      const mainContent = text.substring(0, referencesMatch.index).trim();\n      const referencesText = referencesMatch[1];\n      return {\n        mainContent,\n        referencesText\n      };\n    }\n    return {\n      mainContent: text,\n      referencesText: null\n    };\n  };\n  const {\n    mainContent: rawMainContent\n  } = type === 'assistant' ? parseContentAndReferences(content) : {\n    mainContent: content\n  };\n\n  // Track if this message was just created (to animate even if isStreaming is false)\n  const prevContentRef = useRef('');\n  const hasAnimatedRef = useRef(false);\n  const messageIdRef = useRef(message.id);\n\n  // Reset animation tracking when message ID changes (new message)\n  useEffect(() => {\n    if (messageIdRef.current !== message.id) {\n      messageIdRef.current = message.id;\n      prevContentRef.current = '';\n      hasAnimatedRef.current = false;\n      console.log('[MessageBubble] New message ID detected, resetting animation state');\n    }\n  }, [message.id]);\n  useEffect(() => {\n    if (type === 'assistant' && rawMainContent) {\n      // If content appeared suddenly (was empty, now has content), it's a new message\n      if (prevContentRef.current === '' && rawMainContent.length > 0 && !hasAnimatedRef.current) {\n        hasAnimatedRef.current = true;\n        console.log('[MessageBubble] New message detected, will animate');\n      }\n      prevContentRef.current = rawMainContent;\n    }\n  }, [rawMainContent, type]);\n\n  // Use animated text for streaming assistant messages OR newly created messages that haven't been animated yet\n  // Animate if streaming OR if this is a new message that just appeared and hasn't been animated\n  const shouldAnimate = (isStreaming || hasAnimatedRef.current && !prevContentRef.current) && type === 'assistant';\n  const animatedContent = useAnimatedText(shouldAnimate && rawMainContent ? rawMainContent : '', ' ',\n  // Word-by-word animation\n  0.03 // 30ms per word (faster animation - about 33 words per second)\n  );\n\n  // Debug logging to verify hook is receiving updates\n  useEffect(() => {\n    if (type === 'assistant') {\n      console.log('[MessageBubble] Content update:', {\n        isStreaming,\n        shouldAnimate,\n        isNewMessage: isNewMessage.current,\n        contentLength: (rawMainContent === null || rawMainContent === void 0 ? void 0 : rawMainContent.length) || 0,\n        animatedLength: (animatedContent === null || animatedContent === void 0 ? void 0 : animatedContent.length) || 0,\n        type,\n        messageId: message.id\n      });\n    }\n  }, [isStreaming, shouldAnimate, rawMainContent, animatedContent, type, message.id]);\n\n  // Use animated content when streaming or for new messages (even if empty initially - it will build up)\n  // Use raw content when not streaming and animation is complete\n  const mainContent = React.useMemo(() => {\n    if (type !== 'assistant') {\n      return rawMainContent;\n    }\n\n    // If we should animate, use animated content\n    if (shouldAnimate) {\n      // If animation hook returns empty but we have content, show at least some of it\n      if (rawMainContent && animatedContent === '' && shouldAnimate) {\n        console.warn('[MessageBubble] Animation hook returned empty, showing raw content');\n        return rawMainContent;\n      }\n      return animatedContent || rawMainContent;\n    }\n\n    // Not animating, show full content\n    return rawMainContent;\n  }, [type, shouldAnimate, rawMainContent, animatedContent]);\n  const handleCopy = () => {\n    navigator.clipboard.writeText(content);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n  const renderAnalysis = analysis => {\n    if (!analysis) return null;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-4 space-y-3\",\n      children: [analysis.summary && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 bg-gray-50 dark:bg-zinc-800/50 rounded-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          className: \"text-sm font-semibold mb-2 text-gray-900 dark:text-white\",\n          children: \"Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm text-gray-700 dark:text-gray-300\",\n          children: analysis.summary\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 11\n      }, this), analysis.approved_claims && analysis.approved_claims.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          className: \"flex items-center gap-2 text-sm font-semibold mb-2 text-green-900 dark:text-green-300\",\n          children: [/*#__PURE__*/_jsxDEV(CheckCircle, {\n            size: 16\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 15\n          }, this), \" Approved Claims\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"space-y-1 list-disc list-inside\",\n          children: analysis.approved_claims.map((claim, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n            className: \"text-sm text-green-800 dark:text-green-200\",\n            children: claim\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }, this);\n  };\n  const startEdit = () => {\n    if (type !== 'user') return;\n    setEditValue(content || '');\n    setIsEditing(true);\n  };\n  const cancelEdit = () => {\n    setIsEditing(false);\n    setEditValue(content || '');\n  };\n  const saveEdit = () => {\n    if (onEdit && typeof onEdit === 'function') {\n      onEdit(editValue);\n    }\n    setIsEditing(false);\n  };\n\n  // Set initial height when editing starts\n  useEffect(() => {\n    if (isEditing && editRef.current) {\n      // Set cursor to end of text\n      editRef.current.focus();\n      editRef.current.selectionStart = editRef.current.value.length;\n      editRef.current.selectionEnd = editRef.current.value.length;\n    }\n  }, [isEditing]);\n\n  // Handle text selection for \"Add to Chat\" feature\n  useEffect(() => {\n    if (type !== 'assistant' || isLoading || isError) return;\n    let savedRange = null;\n    let restoreInterval = null;\n    let selectionStartContainer = null;\n    let selectionStartOffset = 0;\n    let selectionEndContainer = null;\n    let selectionEndOffset = 0;\n    const handleMouseUp = e => {\n      // Check if this is within our message bubble\n      const target = e.target;\n      if (!messageRef.current || !messageRef.current.contains(target)) {\n        return;\n      }\n\n      // Capture selection IMMEDIATELY and synchronously before anything else can clear it\n      const selection = window.getSelection();\n      if (!selection || selection.rangeCount === 0) {\n        return;\n      }\n      const range = selection.getRangeAt(0);\n      const selectedTextValue = selection.toString().trim();\n\n      // Only show button if selection is meaningful (more than 10 chars)\n      if (selectedTextValue.length < 10) {\n        return;\n      }\n\n      // Check if selection is within this message bubble\n      if (!messageRef.current.contains(range.commonAncestorContainer)) {\n        return;\n      }\n\n      // Save range details for restoration\n      try {\n        savedRange = range.cloneRange();\n        selectionStartContainer = range.startContainer;\n        selectionStartOffset = range.startOffset;\n        selectionEndContainer = range.endContainer;\n        selectionEndOffset = range.endOffset;\n      } catch (err) {\n        console.warn('Failed to save range:', err);\n        return;\n      }\n\n      // Store the selected text and position IMMEDIATELY\n      setSelectedText(selectedTextValue);\n\n      // Get selection position\n      const rect = range.getBoundingClientRect();\n      setSelectionPosition({\n        x: rect.left + rect.width / 2,\n        y: rect.top\n      });\n\n      // Clear any existing interval\n      if (restoreInterval) {\n        clearInterval(restoreInterval);\n        restoreInterval = null;\n      }\n\n      // Function to restore selection\n      const preserveSelection = () => {\n        if (!selectedTextRef.current) return;\n        try {\n          const currentSelection = window.getSelection();\n          if (!currentSelection) return;\n\n          // Check if selection is already there\n          if (currentSelection.rangeCount > 0) {\n            const currentRange = currentSelection.getRangeAt(0);\n            const currentText = currentRange.toString().trim();\n            // If selection matches, keep it\n            if (currentText === selectedTextRef.current) {\n              return;\n            }\n          }\n\n          // Try to restore using saved range first\n          if (savedRange) {\n            try {\n              currentSelection.removeAllRanges();\n              currentSelection.addRange(savedRange.cloneRange());\n              return;\n            } catch (err) {\n              // Range might be invalid, try recreating from offsets\n            }\n          }\n\n          // Fallback: try to recreate from saved offsets\n          if (selectionStartContainer && selectionEndContainer) {\n            try {\n              const newRange = document.createRange();\n              newRange.setStart(selectionStartContainer, selectionStartOffset);\n              newRange.setEnd(selectionEndContainer, selectionEndOffset);\n              currentSelection.removeAllRanges();\n              currentSelection.addRange(newRange);\n            } catch (err) {\n              // Containers might be invalid, ignore\n            }\n          }\n        } catch (err) {\n          // Ignore errors\n        }\n      };\n\n      // Try to preserve immediately multiple times\n      setTimeout(preserveSelection, 0);\n      setTimeout(preserveSelection, 10);\n      setTimeout(preserveSelection, 50);\n      setTimeout(preserveSelection, 100);\n\n      // Keep restoring selection periodically until button is clicked\n      restoreInterval = setInterval(() => {\n        // Check if we still have selectedText state using ref (more reliable)\n        if (!selectedTextRef.current) {\n          if (restoreInterval) {\n            clearInterval(restoreInterval);\n            restoreInterval = null;\n          }\n          savedRange = null;\n          return;\n        }\n        preserveSelection();\n      }, 100); // Check frequently to maintain highlight\n    };\n\n    // Listen for clicks outside to clear selection (with delay to avoid immediate clearing)\n    const handleClickOutside = e => {\n      const target = e.target;\n\n      // Don't clear if clicking on the button itself\n      if (target.closest('.floating-add-to-chat-button')) {\n        return;\n      }\n\n      // Don't clear if clicking within the message bubble\n      if (messageRef.current && messageRef.current.contains(target)) {\n        return;\n      }\n\n      // Don't clear if clicking on the input area (contentEditable or its container)\n      if (target.closest('#prompt-textarea') || target.closest('.ProseMirror') || target.closest('[data-type=\"text\"]') || target.closest('form[data-type=\"text\"]')) {\n        return;\n      }\n\n      // Delay clearing to avoid interfering with selection\n      setTimeout(() => {\n        const currentSelection = window.getSelection();\n        if (currentSelection) {\n          // Only clear if the selection is not in the input area\n          const activeElement = document.activeElement;\n          const isInputFocused = (activeElement === null || activeElement === void 0 ? void 0 : activeElement.closest('#prompt-textarea')) || (activeElement === null || activeElement === void 0 ? void 0 : activeElement.closest('.ProseMirror')) || (activeElement === null || activeElement === void 0 ? void 0 : activeElement.closest('[data-type=\"text\"]'));\n          if (!isInputFocused) {\n            currentSelection.removeAllRanges();\n          }\n        }\n        setSelectedText('');\n        setSelectionPosition(null);\n      }, 50);\n    };\n\n    // Use capture phase to catch mouseup early\n    document.addEventListener('mouseup', handleMouseUp, true);\n    document.addEventListener('click', handleClickOutside, true);\n    return () => {\n      if (restoreInterval) {\n        clearInterval(restoreInterval);\n      }\n      document.removeEventListener('mouseup', handleMouseUp, true);\n      document.removeEventListener('click', handleClickOutside, true);\n    };\n  }, [type, isLoading, isError, selectedText]);\n  const handleAddToChat = () => {\n    if (selectedText) {\n      setSelectedTextContext({\n        text: selectedText,\n        sourceMessageId: message.id\n      });\n      // Clear selection and state AFTER adding to chat\n      const selection = window.getSelection();\n      if (selection) {\n        selection.removeAllRanges();\n      }\n      setSelectedText('');\n      setSelectionPosition(null);\n    }\n  };\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex w-full justify-start animate-message-in\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"max-w-3xl w-full p-4\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-2 h-2 bg-gradient-to-r from-[#003595] to-[#1a4ba3] rounded-full animate-typing-dot\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 413,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-2 h-2 bg-gradient-to-r from-[#003595] to-[#1a4ba3] rounded-full animate-typing-dot\",\n              style: {\n                animationDelay: '0.2s'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 414,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-2 h-2 bg-gradient-to-r from-[#003595] to-[#1a4ba3] rounded-full animate-typing-dot\",\n              style: {\n                animationDelay: '0.4s'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 415,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 412,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-base text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary font-medium\",\n            children: \"EyeQ is analyzing...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 417,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: messageRef,\n    className: `w-full group ${isError ? 'opacity-75' : ''}`,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: `flex w-full flex-wrap ${type === 'user' ? 'justify-end' : 'justify-start'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `\n          transition-all duration-300\n          ${type === 'user' ? 'inline-flex max-w-[85%] rounded-2xl bg-gradient-to-br from-[#003595] to-[#1a4ba3] text-white shadow-lg shadow-[#003595]/20 hover:shadow-xl hover:shadow-[#003595]/30 hover:scale-[1.01] animate-message-in' : 'max-w-3xl w-full text-chatgpt-text-primary dark:text-chatgpt-dark-text-primary animate-message-in'}\n          ${isError ? 'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800' : ''}\n        `,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `${type === 'user' ? 'px-4 py-3' : 'p-4 sm:p-5'} space-y-2 sm:space-y-3`,\n          children: [type === 'user' && message.attachments && message.attachments.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-2 mb-2\",\n            children: message.attachments.map(attachment => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"inline-flex flex-col p-3 bg-white dark:bg-[#1F2937] border border-[#E5E7EB] dark:border-[#4B5563] rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.05)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] max-w-md\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center gap-2\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex-shrink-0\",\n                  children: attachment.type === 'text' ? /*#__PURE__*/_jsxDEV(\"svg\", {\n                    width: \"16\",\n                    height: \"16\",\n                    viewBox: \"0 0 20 20\",\n                    fill: \"none\",\n                    xmlns: \"http://www.w3.org/2000/svg\",\n                    className: \"text-[#6B7280] dark:text-[#9CA3AF]\",\n                    children: /*#__PURE__*/_jsxDEV(\"path\", {\n                      d: \"M2.94 2.94a1 1 0 0 1 1.02-.24l13.33 4.44a1 1 0 0 1 0 1.9L9.9 11.2a1 1 0 0 0-.7.7L7.04 17.29a1 1 0 0 1-1.9 0L.7 3.96a1 1 0 0 1 .24-1.02zm3.3 12.82l1.32-3.96a3 3 0 0 1 2.1-2.1l6.03-2-9.45-3.15 0 0 0 0L3.6 3.6l2.64 12.16z\",\n                      fill: \"currentColor\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 451,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 450,\n                    columnNumber: 25\n                  }, this) : attachment.type === 'file' ? /*#__PURE__*/_jsxDEV(FileText, {\n                    size: 16,\n                    className: \"text-[#6B7280] dark:text-[#9CA3AF]\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 454,\n                    columnNumber: 25\n                  }, this) : /*#__PURE__*/_jsxDEV(FileText, {\n                    size: 16,\n                    className: \"text-[#6B7280] dark:text-[#9CA3AF]\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 456,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 448,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-[15px] font-medium text-[#1F2937] dark:text-[#F9FAFB]\",\n                  children: attachment.title\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 459,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 447,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-[12px] text-[#6B7280] dark:text-[#9CA3AF] mt-0.5\",\n                children: \"Attachment\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 463,\n                columnNumber: 19\n              }, this)]\n            }, attachment.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 443,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 441,\n            columnNumber: 13\n          }, this), file && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `flex items-center gap-3 text-sm p-3 rounded-2xl ${type === 'user' ? 'bg-white/20 text-white' : 'bg-chatgpt-bg-secondary dark:bg-chatgpt-dark-bg-secondary'}`,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `p-1.5 rounded-lg ${type === 'user' ? 'bg-white/20' : 'bg-alcon-blue/10'}`,\n              children: /*#__PURE__*/_jsxDEV(FileText, {\n                size: 16,\n                className: type === 'user' ? 'text-white' : 'text-alcon-blue'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 478,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 477,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `font-medium ${type === 'user' ? 'text-white' : 'text-chatgpt-text-primary dark:text-chatgpt-dark-text-primary'}`,\n              children: [\"Uploaded: \", file.name]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 480,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 472,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `${isEditing && type === 'user' ? 'space-y-2' : ''}`,\n            children: type === 'user' ? isEditing ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"space-y-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n                ref: editRef,\n                className: \"w-full bg-[#002870] text-white rounded-lg p-3 border border-white/20 focus:ring-2 focus:ring-white/50 focus:border-transparent focus:outline-none resize-none text-sm leading-relaxed overflow-y-auto\",\n                style: {\n                  minHeight: '100px',\n                  maxHeight: '200px'\n                },\n                value: editValue,\n                onChange: e => setEditValue(e.target.value),\n                autoFocus: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 488,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-end gap-2\",\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"px-3 py-1.5 rounded-lg bg-white/10 text-white hover:bg-white/20 transition-colors text-sm font-medium\",\n                  onClick: cancelEdit,\n                  children: \"Cancel\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 497,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"px-3 py-1.5 rounded-lg bg-white text-[#003595] hover:bg-white/90 transition-colors text-sm font-medium\",\n                  onClick: saveEdit,\n                  children: \"Save\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 503,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 496,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 487,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"leading-relaxed\",\n              children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n                remarkPlugins: [remarkGfm],\n                children: content || ''\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 513,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 512,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"prose prose-sm dark:prose-invert max-w-none text-base leading-relaxed prose-headings:text-base prose-headings:font-semibold prose-headings:mt-4 prose-headings:mb-2 prose-p:my-2 prose-ul:my-2 prose-ol:my-2 prose-li:my-1 select-text\",\n              style: {\n                userSelect: 'text',\n                WebkitUserSelect: 'text',\n                lineHeight: '1.7'\n              },\n              children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n                remarkPlugins: [remarkGfm],\n                children: mainContent || ''\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 523,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 519,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 484,\n            columnNumber: 11\n          }, this), isStreaming && type === 'assistant' && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"inline-block w-1 h-4 bg-chatgpt-text-primary dark:bg-chatgpt-dark-text-primary animate-pulse ml-0.5 align-middle\",\n            children: \"|\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 531,\n            columnNumber: 13\n          }, this), analysis && renderAnalysis(analysis), type === 'assistant' && !isLoading && !isError && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\",\n              onClick: handleCopy,\n              title: copied ? 'Copied!' : 'Copy',\n              \"aria-label\": \"Copy message\",\n              children: copied ? /*#__PURE__*/_jsxDEV(Check, {\n                size: 18,\n                className: \"text-alcon-blue\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 545,\n                columnNumber: 27\n              }, this) : /*#__PURE__*/_jsxDEV(Copy, {\n                size: 18,\n                className: \"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 545,\n                columnNumber: 77\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 539,\n              columnNumber: 15\n            }, this), isLast && onRegenerate && /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\",\n              onClick: onRegenerate,\n              title: \"Regenerate response\",\n              \"aria-label\": \"Regenerate response\",\n              children: /*#__PURE__*/_jsxDEV(RefreshCw, {\n                size: 18,\n                className: \"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 555,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 549,\n              columnNumber: 17\n            }, this), onShare && /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\",\n              onClick: () => onShare(message),\n              title: \"Share conversation\",\n              \"aria-label\": \"Share conversation\",\n              children: /*#__PURE__*/_jsxDEV(Share2, {\n                size: 18,\n                className: \"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 566,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 560,\n              columnNumber: 17\n            }, this), onExport && /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\",\n              onClick: () => onExport('markdown'),\n              title: \"Export conversation\",\n              \"aria-label\": \"Export conversation\",\n              children: /*#__PURE__*/_jsxDEV(Download, {\n                size: 18,\n                className: \"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 577,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 571,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 538,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 438,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 431,\n        columnNumber: 9\n      }, this), type === 'user' && !isEditing && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"basis-full flex justify-end gap-2 mt-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\",\n          onClick: handleCopy,\n          title: copied ? 'Copied!' : 'Copy',\n          \"aria-label\": \"Copy message\",\n          children: copied ? /*#__PURE__*/_jsxDEV(Check, {\n            size: 18,\n            className: \"text-alcon-blue\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 594,\n            columnNumber: 23\n          }, this) : /*#__PURE__*/_jsxDEV(Copy, {\n            size: 18,\n            className: \"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 594,\n            columnNumber: 73\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 588,\n          columnNumber: 11\n        }, this), isLastUserMessage && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\",\n          onClick: startEdit,\n          title: \"Edit message\",\n          \"aria-label\": \"Edit message\",\n          children: /*#__PURE__*/_jsxDEV(Pencil, {\n            size: 18,\n            className: \"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 603,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 597,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 587,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 429,\n      columnNumber: 7\n    }, this), selectedText && selectionPosition && type === 'assistant' && !isLoading && !isError && /*#__PURE__*/_jsxDEV(FloatingAddToChatButton, {\n      position: selectionPosition,\n      onAddToChat: handleAddToChat\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 613,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 425,\n    columnNumber: 5\n  }, this);\n};\n_s(MessageBubble, \"qiyWvQsGgNol+NVVMB8Lw39PkaQ=\", false, function () {\n  return [useAnimatedText];\n});\n_c = MessageBubble;\nexport default MessageBubble;\nvar _c;\n$RefreshReg$(_c, \"MessageBubble\");","map":{"version":3,"names":["React","useState","useRef","useEffect","CheckCircle","FileText","Copy","Check","RefreshCw","Share2","Download","Pencil","ReactMarkdown","remarkGfm","FloatingAddToChatButton","ChatContext","useAnimatedText","jsxDEV","_jsxDEV","MessageBubble","message","isLast","onRegenerate","onShare","onExport","onEdit","isLastUserMessage","_s","type","content","analysis","file","isLoading","isError","isStreaming","copied","setCopied","isEditing","setIsEditing","editValue","setEditValue","editRef","selectedText","setSelectedText","selectionPosition","setSelectionPosition","messageRef","selectedTextRef","setSelectedTextContext","useContext","current","parseContentAndReferences","text","mainContent","referencesText","referencesMatch","match","substring","index","trim","rawMainContent","prevContentRef","hasAnimatedRef","messageIdRef","id","console","log","length","shouldAnimate","animatedContent","isNewMessage","contentLength","animatedLength","messageId","useMemo","warn","handleCopy","navigator","clipboard","writeText","setTimeout","renderAnalysis","className","children","summary","fileName","_jsxFileName","lineNumber","columnNumber","approved_claims","size","map","claim","startEdit","cancelEdit","saveEdit","focus","selectionStart","value","selectionEnd","savedRange","restoreInterval","selectionStartContainer","selectionStartOffset","selectionEndContainer","selectionEndOffset","handleMouseUp","e","target","contains","selection","window","getSelection","rangeCount","range","getRangeAt","selectedTextValue","toString","commonAncestorContainer","cloneRange","startContainer","startOffset","endContainer","endOffset","err","rect","getBoundingClientRect","x","left","width","y","top","clearInterval","preserveSelection","currentSelection","currentRange","currentText","removeAllRanges","addRange","newRange","document","createRange","setStart","setEnd","setInterval","handleClickOutside","closest","activeElement","isInputFocused","addEventListener","removeEventListener","handleAddToChat","sourceMessageId","style","animationDelay","ref","attachments","attachment","height","viewBox","fill","xmlns","d","title","name","minHeight","maxHeight","onChange","autoFocus","onClick","remarkPlugins","userSelect","WebkitUserSelect","lineHeight","position","onAddToChat","_c","$RefreshReg$"],"sources":["C:/Users/josep/OneDrive/Documents/Jason/EyeQ MLR Agent/alcon-mlr-agent/web-interface/src/components/MessageBubble.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { CheckCircle, FileText, Copy, Check, RefreshCw, Share2, Download, Pencil } from 'lucide-react';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport { Message, Analysis } from '../types';\nimport FloatingAddToChatButton from './FloatingAddToChatButton';\nimport { ChatContext } from '../ChatContext';\nimport { useAnimatedText } from './ui/animated-text';\n\ninterface MessageBubbleProps {\n  message: Message;\n  isLast: boolean;\n  onRegenerate?: () => void;\n  onShare?: (message: Message) => void;\n  onExport?: (format: string) => void;\n  editable?: boolean;\n  onEdit?: (newText: string) => void;\n  isLastUserMessage?: boolean;\n}\n\ninterface ParsedContent {\n  mainContent: string;\n  referencesText: string | null;\n}\n\nconst MessageBubble: React.FC<MessageBubbleProps> = ({\n  message,\n  isLast,\n  onRegenerate,\n  onShare,\n  onExport,\n  onEdit,\n  isLastUserMessage = false\n}) => {\n  const { type, content, analysis, file, isLoading, isError, isStreaming } = message;\n  const [copied, setCopied] = useState(false);\n  const [isEditing, setIsEditing] = useState(false);\n  const [editValue, setEditValue] = useState(content || '');\n  const editRef = useRef<HTMLTextAreaElement>(null);\n  const [selectedText, setSelectedText] = useState<string>('');\n  const [selectionPosition, setSelectionPosition] = useState<{ x: number; y: number } | null>(null);\n  const messageRef = useRef<HTMLDivElement>(null);\n  const selectedTextRef = useRef<string>('');\n  const { setSelectedTextContext } = React.useContext(ChatContext);\n  \n  // Keep ref in sync with state\n  useEffect(() => {\n    selectedTextRef.current = selectedText;\n  }, [selectedText]);\n  \n  // Parse content to separate main text from references section\n  const parseContentAndReferences = (text: string): ParsedContent => {\n    if (!text) return { mainContent: '', referencesText: null };\n    \n    // Check for References section\n    const referencesMatch = text.match(/(?:^|\\n)(References?:[\\s\\S]*)$/i);\n    \n    if (referencesMatch) {\n      const mainContent = text.substring(0, referencesMatch.index!).trim();\n      const referencesText = referencesMatch[1];\n      return { mainContent, referencesText };\n    }\n    \n    return { mainContent: text, referencesText: null };\n  };\n  \n  const { mainContent: rawMainContent } = type === 'assistant' \n    ? parseContentAndReferences(content) \n    : { mainContent: content };\n\n  // Track if this message was just created (to animate even if isStreaming is false)\n  const prevContentRef = useRef<string>('');\n  const hasAnimatedRef = useRef<boolean>(false);\n  const messageIdRef = useRef<number | string>(message.id);\n  \n  // Reset animation tracking when message ID changes (new message)\n  useEffect(() => {\n    if (messageIdRef.current !== message.id) {\n      messageIdRef.current = message.id;\n      prevContentRef.current = '';\n      hasAnimatedRef.current = false;\n      console.log('[MessageBubble] New message ID detected, resetting animation state');\n    }\n  }, [message.id]);\n  \n  useEffect(() => {\n    if (type === 'assistant' && rawMainContent) {\n      // If content appeared suddenly (was empty, now has content), it's a new message\n      if (prevContentRef.current === '' && rawMainContent.length > 0 && !hasAnimatedRef.current) {\n        hasAnimatedRef.current = true;\n        console.log('[MessageBubble] New message detected, will animate');\n      }\n      prevContentRef.current = rawMainContent;\n    }\n  }, [rawMainContent, type]);\n\n  // Use animated text for streaming assistant messages OR newly created messages that haven't been animated yet\n  // Animate if streaming OR if this is a new message that just appeared and hasn't been animated\n  const shouldAnimate = (isStreaming || (hasAnimatedRef.current && !prevContentRef.current)) && type === 'assistant';\n  const animatedContent = useAnimatedText(\n    shouldAnimate && rawMainContent ? rawMainContent : '',\n    ' ', // Word-by-word animation\n    0.03 // 30ms per word (faster animation - about 33 words per second)\n  );\n\n  // Debug logging to verify hook is receiving updates\n  useEffect(() => {\n    if (type === 'assistant') {\n      console.log('[MessageBubble] Content update:', {\n        isStreaming,\n        shouldAnimate,\n        isNewMessage: isNewMessage.current,\n        contentLength: rawMainContent?.length || 0,\n        animatedLength: animatedContent?.length || 0,\n        type,\n        messageId: message.id\n      });\n    }\n  }, [isStreaming, shouldAnimate, rawMainContent, animatedContent, type, message.id]);\n\n  // Use animated content when streaming or for new messages (even if empty initially - it will build up)\n  // Use raw content when not streaming and animation is complete\n  const mainContent = React.useMemo(() => {\n    if (type !== 'assistant') {\n      return rawMainContent;\n    }\n    \n    // If we should animate, use animated content\n    if (shouldAnimate) {\n      // If animation hook returns empty but we have content, show at least some of it\n      if (rawMainContent && animatedContent === '' && shouldAnimate) {\n        console.warn('[MessageBubble] Animation hook returned empty, showing raw content');\n        return rawMainContent;\n      }\n      return animatedContent || rawMainContent;\n    }\n    \n    // Not animating, show full content\n    return rawMainContent;\n  }, [type, shouldAnimate, rawMainContent, animatedContent]);\n\n  const handleCopy = () => {\n    navigator.clipboard.writeText(content);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  const renderAnalysis = (analysis: Analysis) => {\n    if (!analysis) return null;\n\n    return (\n      <div className=\"mt-4 space-y-3\">\n        {analysis.summary && (\n          <div className=\"p-4 bg-gray-50 dark:bg-zinc-800/50 rounded-lg\">\n            <h4 className=\"text-sm font-semibold mb-2 text-gray-900 dark:text-white\">Summary</h4>\n            <p className=\"text-sm text-gray-700 dark:text-gray-300\">{analysis.summary}</p>\n          </div>\n        )}\n\n        {analysis.approved_claims && analysis.approved_claims.length > 0 && (\n          <div className=\"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n            <h4 className=\"flex items-center gap-2 text-sm font-semibold mb-2 text-green-900 dark:text-green-300\">\n              <CheckCircle size={16} /> Approved Claims\n            </h4>\n            <ul className=\"space-y-1 list-disc list-inside\">\n              {analysis.approved_claims.map((claim, index) => (\n                <li key={index} className=\"text-sm text-green-800 dark:text-green-200\">{claim}</li>\n              ))}\n            </ul>\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  const startEdit = () => {\n    if (type !== 'user') return;\n    setEditValue(content || '');\n    setIsEditing(true);\n  };\n\n  const cancelEdit = () => {\n    setIsEditing(false);\n    setEditValue(content || '');\n  };\n\n  const saveEdit = () => {\n    if (onEdit && typeof onEdit === 'function') {\n      onEdit(editValue);\n    }\n    setIsEditing(false);\n  };\n\n  // Set initial height when editing starts\n  useEffect(() => {\n    if (isEditing && editRef.current) {\n      // Set cursor to end of text\n      editRef.current.focus();\n      editRef.current.selectionStart = editRef.current.value.length;\n      editRef.current.selectionEnd = editRef.current.value.length;\n    }\n  }, [isEditing]);\n\n  // Handle text selection for \"Add to Chat\" feature\n  useEffect(() => {\n    if (type !== 'assistant' || isLoading || isError) return;\n\n    let savedRange: Range | null = null;\n    let restoreInterval: NodeJS.Timeout | null = null;\n    let selectionStartContainer: Node | null = null;\n    let selectionStartOffset: number = 0;\n    let selectionEndContainer: Node | null = null;\n    let selectionEndOffset: number = 0;\n\n    const handleMouseUp = (e: MouseEvent) => {\n      // Check if this is within our message bubble\n      const target = e.target as HTMLElement;\n      if (!messageRef.current || !messageRef.current.contains(target)) {\n        return;\n      }\n\n      // Capture selection IMMEDIATELY and synchronously before anything else can clear it\n      const selection = window.getSelection();\n      if (!selection || selection.rangeCount === 0) {\n        return;\n      }\n\n      const range = selection.getRangeAt(0);\n      const selectedTextValue = selection.toString().trim();\n      \n      // Only show button if selection is meaningful (more than 10 chars)\n      if (selectedTextValue.length < 10) {\n        return;\n      }\n\n      // Check if selection is within this message bubble\n      if (!messageRef.current.contains(range.commonAncestorContainer)) {\n        return;\n      }\n\n      // Save range details for restoration\n      try {\n        savedRange = range.cloneRange();\n        selectionStartContainer = range.startContainer;\n        selectionStartOffset = range.startOffset;\n        selectionEndContainer = range.endContainer;\n        selectionEndOffset = range.endOffset;\n      } catch (err) {\n        console.warn('Failed to save range:', err);\n        return;\n      }\n\n      // Store the selected text and position IMMEDIATELY\n      setSelectedText(selectedTextValue);\n\n      // Get selection position\n      const rect = range.getBoundingClientRect();\n      setSelectionPosition({\n        x: rect.left + rect.width / 2,\n        y: rect.top\n      });\n\n      // Clear any existing interval\n      if (restoreInterval) {\n        clearInterval(restoreInterval);\n        restoreInterval = null;\n      }\n\n      // Function to restore selection\n      const preserveSelection = () => {\n        if (!selectedTextRef.current) return;\n        \n        try {\n          const currentSelection = window.getSelection();\n          if (!currentSelection) return;\n          \n          // Check if selection is already there\n          if (currentSelection.rangeCount > 0) {\n            const currentRange = currentSelection.getRangeAt(0);\n            const currentText = currentRange.toString().trim();\n            // If selection matches, keep it\n            if (currentText === selectedTextRef.current) {\n              return;\n            }\n          }\n          \n          // Try to restore using saved range first\n          if (savedRange) {\n            try {\n              currentSelection.removeAllRanges();\n              currentSelection.addRange(savedRange.cloneRange());\n              return;\n            } catch (err) {\n              // Range might be invalid, try recreating from offsets\n            }\n          }\n          \n          // Fallback: try to recreate from saved offsets\n          if (selectionStartContainer && selectionEndContainer) {\n            try {\n              const newRange = document.createRange();\n              newRange.setStart(selectionStartContainer, selectionStartOffset);\n              newRange.setEnd(selectionEndContainer, selectionEndOffset);\n              currentSelection.removeAllRanges();\n              currentSelection.addRange(newRange);\n            } catch (err) {\n              // Containers might be invalid, ignore\n            }\n          }\n        } catch (err) {\n          // Ignore errors\n        }\n      };\n\n      // Try to preserve immediately multiple times\n      setTimeout(preserveSelection, 0);\n      setTimeout(preserveSelection, 10);\n      setTimeout(preserveSelection, 50);\n      setTimeout(preserveSelection, 100);\n\n      // Keep restoring selection periodically until button is clicked\n      restoreInterval = setInterval(() => {\n        // Check if we still have selectedText state using ref (more reliable)\n        if (!selectedTextRef.current) {\n          if (restoreInterval) {\n            clearInterval(restoreInterval);\n            restoreInterval = null;\n          }\n          savedRange = null;\n          return;\n        }\n        \n        preserveSelection();\n      }, 100); // Check frequently to maintain highlight\n    };\n\n    // Listen for clicks outside to clear selection (with delay to avoid immediate clearing)\n    const handleClickOutside = (e: MouseEvent) => {\n      const target = e.target as HTMLElement;\n      \n      // Don't clear if clicking on the button itself\n      if (target.closest('.floating-add-to-chat-button')) {\n        return;\n      }\n      \n      // Don't clear if clicking within the message bubble\n      if (messageRef.current && messageRef.current.contains(target)) {\n        return;\n      }\n\n      // Don't clear if clicking on the input area (contentEditable or its container)\n      if (target.closest('#prompt-textarea') || \n          target.closest('.ProseMirror') || \n          target.closest('[data-type=\"text\"]') ||\n          target.closest('form[data-type=\"text\"]')) {\n        return;\n      }\n\n      // Delay clearing to avoid interfering with selection\n      setTimeout(() => {\n        const currentSelection = window.getSelection();\n        if (currentSelection) {\n          // Only clear if the selection is not in the input area\n          const activeElement = document.activeElement;\n          const isInputFocused = activeElement?.closest('#prompt-textarea') || \n                                 activeElement?.closest('.ProseMirror') ||\n                                 activeElement?.closest('[data-type=\"text\"]');\n          \n          if (!isInputFocused) {\n            currentSelection.removeAllRanges();\n          }\n        }\n        setSelectedText('');\n        setSelectionPosition(null);\n      }, 50);\n    };\n\n    // Use capture phase to catch mouseup early\n    document.addEventListener('mouseup', handleMouseUp, true);\n    document.addEventListener('click', handleClickOutside, true);\n\n    return () => {\n      if (restoreInterval) {\n        clearInterval(restoreInterval);\n      }\n      document.removeEventListener('mouseup', handleMouseUp, true);\n      document.removeEventListener('click', handleClickOutside, true);\n    };\n  }, [type, isLoading, isError, selectedText]);\n\n  const handleAddToChat = () => {\n    if (selectedText) {\n      setSelectedTextContext({\n        text: selectedText,\n        sourceMessageId: message.id\n      });\n      // Clear selection and state AFTER adding to chat\n      const selection = window.getSelection();\n      if (selection) {\n        selection.removeAllRanges();\n      }\n      setSelectedText('');\n      setSelectionPosition(null);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex w-full justify-start animate-message-in\">\n        <div className=\"max-w-3xl w-full p-4\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-2 h-2 bg-gradient-to-r from-[#003595] to-[#1a4ba3] rounded-full animate-typing-dot\"></div>\n              <div className=\"w-2 h-2 bg-gradient-to-r from-[#003595] to-[#1a4ba3] rounded-full animate-typing-dot\" style={{ animationDelay: '0.2s' }}></div>\n              <div className=\"w-2 h-2 bg-gradient-to-r from-[#003595] to-[#1a4ba3] rounded-full animate-typing-dot\" style={{ animationDelay: '0.4s' }}></div>\n            </div>\n            <span className=\"text-base text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary font-medium\">EyeQ is analyzing...</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div \n      ref={messageRef}\n      className={`w-full group ${isError ? 'opacity-75' : ''}`}\n    >\n      <div className={`flex w-full flex-wrap ${type === 'user' ? 'justify-end' : 'justify-start'}`}>\n        \n        <div className={`\n          transition-all duration-300\n          ${type === 'user' \n            ? 'inline-flex max-w-[85%] rounded-2xl bg-gradient-to-br from-[#003595] to-[#1a4ba3] text-white shadow-lg shadow-[#003595]/20 hover:shadow-xl hover:shadow-[#003595]/30 hover:scale-[1.01] animate-message-in' \n            : 'max-w-3xl w-full text-chatgpt-text-primary dark:text-chatgpt-dark-text-primary animate-message-in'}\n          ${isError ? 'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800' : ''}\n        `}>\n        <div className={`${type === 'user' ? 'px-4 py-3' : 'p-4 sm:p-5'} space-y-2 sm:space-y-3`}>\n          {/* Render attachments as clean cards (ChatGPT style) - Only for user messages */}\n          {type === 'user' && message.attachments && message.attachments.length > 0 && (\n            <div className=\"space-y-2 mb-2\">\n              {message.attachments.map((attachment) => (\n                <div \n                  key={attachment.id}\n                  className=\"inline-flex flex-col p-3 bg-white dark:bg-[#1F2937] border border-[#E5E7EB] dark:border-[#4B5563] rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.05)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] max-w-md\"\n                >\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"flex-shrink-0\">\n                      {attachment.type === 'text' ? (\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" className=\"text-[#6B7280] dark:text-[#9CA3AF]\">\n                          <path d=\"M2.94 2.94a1 1 0 0 1 1.02-.24l13.33 4.44a1 1 0 0 1 0 1.9L9.9 11.2a1 1 0 0 0-.7.7L7.04 17.29a1 1 0 0 1-1.9 0L.7 3.96a1 1 0 0 1 .24-1.02zm3.3 12.82l1.32-3.96a3 3 0 0 1 2.1-2.1l6.03-2-9.45-3.15 0 0 0 0L3.6 3.6l2.64 12.16z\" fill=\"currentColor\"></path>\n                        </svg>\n                      ) : attachment.type === 'file' ? (\n                        <FileText size={16} className=\"text-[#6B7280] dark:text-[#9CA3AF]\" />\n                      ) : (\n                        <FileText size={16} className=\"text-[#6B7280] dark:text-[#9CA3AF]\" />\n                      )}\n                    </div>\n                    <span className=\"text-[15px] font-medium text-[#1F2937] dark:text-[#F9FAFB]\">\n                      {attachment.title}\n                    </span>\n                  </div>\n                  <span className=\"text-[12px] text-[#6B7280] dark:text-[#9CA3AF] mt-0.5\">\n                    Attachment\n                  </span>\n                </div>\n              ))}\n            </div>\n          )}\n\n          {file && (\n            <div className={`flex items-center gap-3 text-sm p-3 rounded-2xl ${\n              type === 'user' \n                ? 'bg-white/20 text-white' \n                : 'bg-chatgpt-bg-secondary dark:bg-chatgpt-dark-bg-secondary'\n            }`}>\n              <div className={`p-1.5 rounded-lg ${type === 'user' ? 'bg-white/20' : 'bg-alcon-blue/10'}`}>\n                <FileText size={16} className={type === 'user' ? 'text-white' : 'text-alcon-blue'} />\n              </div>\n              <span className={`font-medium ${type === 'user' ? 'text-white' : 'text-chatgpt-text-primary dark:text-chatgpt-dark-text-primary'}`}>Uploaded: {file.name}</span>\n            </div>\n          )}\n\n          <div className={`${isEditing && type === 'user' ? 'space-y-2' : ''}`}>\n            {type === 'user' ? (\n              isEditing ? (\n                <div className=\"space-y-2\">\n                  <textarea\n                    ref={editRef}\n                    className=\"w-full bg-[#002870] text-white rounded-lg p-3 border border-white/20 focus:ring-2 focus:ring-white/50 focus:border-transparent focus:outline-none resize-none text-sm leading-relaxed overflow-y-auto\"\n                    style={{ minHeight: '100px', maxHeight: '200px' }}\n                    value={editValue}\n                    onChange={(e) => setEditValue(e.target.value)}\n                    autoFocus\n                  />\n                  <div className=\"flex justify-end gap-2\">\n                    <button \n                      className=\"px-3 py-1.5 rounded-lg bg-white/10 text-white hover:bg-white/20 transition-colors text-sm font-medium\"\n                      onClick={cancelEdit}\n                    >\n                      Cancel\n                    </button>\n                    <button \n                      className=\"px-3 py-1.5 rounded-lg bg-white text-[#003595] hover:bg-white/90 transition-colors text-sm font-medium\"\n                      onClick={saveEdit}\n                    >\n                      Save\n                    </button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"leading-relaxed\">\n                  <ReactMarkdown remarkPlugins={[remarkGfm]}>\n                    {content || ''}\n                  </ReactMarkdown>\n                </div>\n              )\n            ) : (\n              <div \n                className=\"prose prose-sm dark:prose-invert max-w-none text-base leading-relaxed prose-headings:text-base prose-headings:font-semibold prose-headings:mt-4 prose-headings:mb-2 prose-p:my-2 prose-ul:my-2 prose-ol:my-2 prose-li:my-1 select-text\"\n                style={{ userSelect: 'text', WebkitUserSelect: 'text', lineHeight: '1.7' }}\n              >\n                <ReactMarkdown remarkPlugins={[remarkGfm]}>\n                  {mainContent || ''}\n                </ReactMarkdown>\n              </div>\n            )}\n          </div>\n\n          {isStreaming && type === 'assistant' && (\n            <span className=\"inline-block w-1 h-4 bg-chatgpt-text-primary dark:bg-chatgpt-dark-text-primary animate-pulse ml-0.5 align-middle\">|</span>\n          )}\n\n          {analysis && renderAnalysis(analysis)}\n\n          {/* Action buttons for assistant messages - under the message */}\n          {type === 'assistant' && !isLoading && !isError && (\n            <div className=\"flex gap-2\">\n              <button \n                className=\"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\" \n                onClick={handleCopy}\n                title={copied ? 'Copied!' : 'Copy'}\n                aria-label=\"Copy message\"\n              >\n                {copied ? <Check size={18} className=\"text-alcon-blue\" /> : <Copy size={18} className=\"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\" />}\n              </button>\n              \n              {isLast && onRegenerate && (\n                <button \n                  className=\"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\" \n                  onClick={onRegenerate}\n                  title=\"Regenerate response\"\n                  aria-label=\"Regenerate response\"\n                >\n                  <RefreshCw size={18} className=\"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\" />\n                </button>\n              )}\n\n              {onShare && (\n                <button\n                  className=\"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\"\n                  onClick={() => onShare(message)}\n                  title=\"Share conversation\"\n                  aria-label=\"Share conversation\"\n                >\n                  <Share2 size={18} className=\"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\" />\n                </button>\n              )}\n\n              {onExport && (\n                <button\n                  className=\"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\"\n                  onClick={() => onExport('markdown')}\n                  title=\"Export conversation\"\n                  aria-label=\"Export conversation\"\n                >\n                  <Download size={18} className=\"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\" />\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* User action buttons row under the bubble */}\n      {type === 'user' && !isEditing && (\n        <div className=\"basis-full flex justify-end gap-2 mt-2\">\n          <button\n            className=\"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\"\n            onClick={handleCopy}\n            title={copied ? 'Copied!' : 'Copy'}\n            aria-label=\"Copy message\"\n          >\n            {copied ? <Check size={18} className=\"text-alcon-blue\" /> : <Copy size={18} className=\"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\" />}\n          </button>\n          {isLastUserMessage && (\n            <button\n              className=\"p-3 rounded-xl hover:bg-chatgpt-bg-secondary dark:hover:bg-chatgpt-dark-bg-secondary transition-all duration-200 hover:scale-105 active:scale-95 min-w-[44px] min-h-[44px] flex items-center justify-center\"\n              onClick={startEdit}\n              title=\"Edit message\"\n              aria-label=\"Edit message\"\n            >\n              <Pencil size={18} className=\"text-chatgpt-text-secondary dark:text-chatgpt-dark-text-secondary\" />\n            </button>\n          )}\n        </div>\n      )}\n      \n      </div>\n\n      {/* Floating \"Add to Chat\" button */}\n      {selectedText && selectionPosition && type === 'assistant' && !isLoading && !isError && (\n        <FloatingAddToChatButton\n          position={selectionPosition}\n          onAddToChat={handleAddToChat}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default MessageBubble;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}